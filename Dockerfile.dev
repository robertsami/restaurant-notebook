FROM node:20-alpine

WORKDIR /app

# Install only the minimal dependencies required
RUN apk add --no-cache python3 git

# Copy only package files first for better layer caching
COPY package*.json ./

# Install dependencies with production flag to save space
# Then clean npm cache to reduce image size
RUN npm install --production=false && \
    npm cache clean --force

# Copy application code
COPY . .

# Generate Prisma client
RUN npx prisma generate

EXPOSE 59243

CMD ["npm", "run", "dev"]